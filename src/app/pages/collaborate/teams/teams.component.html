<div class="row">
	<div class="col-5 card-teams">
		<app-card cardTitle="Collaboration Teams" #cardTeams [cardButtons]="cardButtons" cardClass="card-datatable" [options]="false">
			<div class="table-responsive">
				<table datatable #teamsTable [dtOptions]="dtTeamsOption" [dtTrigger]="dtTrigger" class="table table-striped table-hover">
					<thead>
						<tr>
							<th>Team name</th>
							<th>Members</th>
							<th>Campaigns</th>
							<th> </th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let team of teams" [id]="team.id">
							<td>{{ team.name }}</td>
							<td>{{ team.members.length }}</td>
							<td>{{ team.assigned_campaigns.length }}</td>
							<td><button class="btn btn-outline-primary btn-normal-padding">Edit</button><button class="btn btn-danger btn-normal-padding">Delete</button></td>
						</tr>
					</tbody>
				</table>
			</div>
		</app-card>
	</div>
	<div class="col-7 card-campaigns">
		<app-card cardTitle="Assigned Campaign" #cardAssignCampaigns [cardButtons]="cardButtonsInCampaigns" cardClass="card-assigned-campaigns" [options]="false">
			<div class="table-responsive">
				<table #campaignTable class="table table-striped table-hover">
					<thead class="campaign-table-header">
						<th>Campaign Name</th>
						<th>Start Date</th>
						<th>End Date</th>
						<th>Progress</th>
						<th>Type</th>
						<th>Status</th>
					</thead>
					<tbody class="campaign-table-body">
						<tr *ngFor="let row of getSelectedCampaigns()" (click)="onClickCampaign(row.id)" [ngClass]="{'selected': row.id === selectedCampaignId}">
							<td>{{row.name}}</td>
							<td>{{row.start_date.substring(0, 11)}}</td>
							<td>{{row.end_date.substring(0, 11)}}</td>
							<td>
								<ngb-progressbar height="20px" [value]="row.percent"></ngb-progressbar>
							</td>
							<td>{{row.type}}</td>
							<td>{{row.status}}</td>
						</tr>
						<tr *ngIf="getSelectedCampaigns().length === 0">
							<td colspan=6 align="center">No data available in table.</td>
						</tr>
					</tbody>
				</table>
			</div>
		</app-card>
		<app-card cardTitle="Tasks" #cardTasks [cardButtons]="cardButtonsInTasks" cardClass="card-tasks" [options]="false">
			<div class="table-responsive">
				<table #taskTable class="table table-striped table-hover">
					<thead class="task-table-header">
						<th>Task Name</th>
						<th>Description</th>
						<th>Start Date</th>
						<th>End Date</th>
						<th>Progress</th>
						<th>Est.</th>
						<th>Member</th>
					</thead>
					<tbody class="task-table-body">
						<tr *ngFor="let task of tasks" (click)="onClickTask(task.id)" [ngClass]="{'selected': task.id === selectedTaskId}">
							<td>{{task.name}}</td>
							<td>{{task.desc}}</td>
							<td>{{task.start_date.substring(0, 11)}}</td>
							<td>{{task.end_date.substring(0, 11)}}</td>
							<td>
								<ngb-progressbar height="20px" [value]="task.percent"></ngb-progressbar>
							</td>
							<td>{{task.esti_hours}}</td>
							<td>{{getUserName(task.user_id)}}</td>
						</tr>
						<tr *ngIf="tasks.length === 0">
							<td colspan=6 align="center">No data available in table</td>
						</tr>
					</tbody>
				</table>
			</div>
		</app-card>
	</div>
</div>


<app-ui-modal #newTeamModal dialogClass="modal-dialog-centered" [dialogClass]="'modal-lg'">
	<div class="app-modal-header">
		<h5 class="modal-title">Create a New Team</h5>
		<button type="button" class="close basic-close" data-dismiss="modal" aria-label="Close" (click)="newTeamModal.hide()">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>

	<div class="app-modal-body">
		<form [formGroup]="teamForm" (ngSubmit)="onCreateTeam()">
			<div class="row">
				<div class="col-md-6">
					<label for="team_name">Team Name</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text"><i class="feather icon-users"></i></span>
						</div>
						<input type="text" class="form-control" id="team_name" placeholder="Team name" formControlName="team_name"  [ngClass]="{ 'is-invalid': submitted && f.team_name.errors }">
					</div>
				</div>
				<div class="col-md-6">
					<label for="team_desc">Short Description</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text"><i class="feather icon-check-square"></i></span>
						</div>
						<input type="text" class="form-control" id="team_desc" placeholder="Short Description"  formControlName="team_desc"  [ngClass]="{ 'is-invalid': submitted && f.team_desc.errors }">
					</div>
				</div>  
			</div>
			<div class="row">
				<div class="col-md-12">
					<label for="team_name">Team Members</label>
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text"><i class="feather icon-user"></i></span>
						</div>
						<ng-select [ngClass]="'ng-select'" [options]="allUsers" [multiple]="true"></ng-select>
					</div>
				</div>
			</div> 
		</form>
	</div>

	<div class="app-modal-footer">
		<button type="button" class="btn btn-primary" (click)="onCreateTeam()">Create</button> &nbsp;
		<button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="newTeamModal.hide()">Close</button>
	</div>
</app-ui-modal>

<app-ui-modal #assignCampaignModal dialogClass="modal-dialog-centered" [dialogClass]="'modal-lg'">
	<div class="app-modal-header">
		<h5 class="modal-title">Assign Campaigns</h5>
		<button type="button" class="close basic-close" data-dismiss="modal" aria-label="Close" (click)="assignCampaignModal.hide()">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>

	<div class="app-modal-body">
		
		<div class="row">
			<div class="col-md-12">
				<div class="input-group assigned_campaigns">
					<div class="input-group-prepend">
						<span class="input-group-text"><i class="feather icon-user"></i> Team</span>
					</div>
					<ng-select [ngClass]="'ng-select'" [options]="teamsInAssignCampaign" (ngModelChange)="onChangeTeam($event)" [(ngModel)]="selectedTeamInAssignCampaigns"></ng-select>
				</div>
			</div>
		</div> 
		<div class="row mt-4">
			<div class="col-md-12">
				<dual-list [sort]="true" [source]="sourceCampaigns" [key]="'id'" [display]="campaignLabel" [filter]="filter"
					[(destination)]="assignedCampaigns" height="265px" [format]="format"></dual-list>
			</div>
		</div> 
		
	</div>

	<div class="app-modal-footer">
		<button type="button" class="btn btn-primary" (click)="onCreateTeam()">Assign</button> &nbsp;
		<button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="assignCampaignModal.hide()">Close</button>
	</div>
</app-ui-modal>

<app-ui-modal #addTaskModal dialogClass="modal-dialog-centered" [dialogClass]="'modal-lg add-task-modal'">
	<div class="app-modal-header">
		<h5 class="modal-title">Add Task</h5>
		<button type="button" class="close basic-close" data-dismiss="modal" aria-label="Close" (click)="addTaskModal.hide()">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>

	<div class="app-modal-body">
		<div class="row">
			<div class="col-md-6">
				<div class="input-group">
					<div class="input-group-prepend">
						<span class="input-group-text">Team</span>
					</div>
					<input type="text" class="form-control" [value]="getSelectedTeamName()" readonly />
				</div>
			</div>
			<div class="col-md-6">
				<div class="input-group">
					<div class="input-group-prepend">
						<span class="input-group-text">Campaigns</span>
					</div>
					<input type="text" class="form-control" [value]="getSelectedCampaignName()" readonly />
				</div>
			</div>
		</div> 
		<div class="row mt-4">
			<div class="col-md-12 input-group">
				<div class="input-group-prepend">
					<span class="input-group-text">Task Name</span>
				</div>
				<input type="text" class="form-control" />
			</div>
		</div>
		<div class="row mt-2">
			<div class="col-md-12 input-group">
				<div class="input-group-prepend">
					<span class="input-group-text">Description</span>
				</div>
				<input type="text" class="form-control" />
			</div>
		</div>

		<div class="row mt-2">
			<div class="col-md-6 input-group">
				<div class="input-group-prepend">
					<span class="input-group-text">Start</span>
				</div>
				<input class="form-control" autocomplete="off" placeholder="yyyy-mm-dd" name="dp_from" ngbDatepicker #d_f="ngbDatepicker">
                <div class="input-group-append">
                  <span class="input-group-text" (click)="d_f.toggle()">
                    <i class="fa fa-calendar"></i>
                  </span>
                </div>
			</div>
			<div class="col-md-6 input-group">
				<div class="input-group-prepend">
					<span class="input-group-text">End</span>
				</div>
				<input class="form-control" autocomplete="off" placeholder="yyyy-mm-dd" name="dp_to" ngbDatepicker #d_t="ngbDatepicker">
                <div class="input-group-append">
                  <span class="input-group-text" (click)="d_t.toggle()">
                    <i class="fa fa-calendar"></i>
                  </span>
                </div>
			</div>
		</div>
		<div class="row mt-2">
			<div class="col-md-6 input-group">
				<div class="input-group-prepend">
					<span class="input-group-text">User</span>
				</div>
				<ng-select [ngClass]="'ng-select'" [options]="teamMembers"></ng-select>
			</div>
			<div class="col-md-6 input-group">
				<div class="input-group-prepend">
					<span class="input-group-text">Estimation</span>
				</div>
				<input type="text" class="form-control" />
			</div>
		</div>
	</div>

	<div class="app-modal-footer">
		<button type="button" class="btn btn-primary" (click)="onCreateTeam()">Assign</button> &nbsp;
		<button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="addTaskModal.hide()">Close</button>
	</div>
</app-ui-modal>
<div class="toast-div">
	<app-toast uID="toast1" toastTitle="Notice" toastCaption="" toastClass="bg-blue-light m-b-10 m-r-10">
		Please Select Campaign.
	</app-toast>
</div>
